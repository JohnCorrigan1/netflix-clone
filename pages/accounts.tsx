import type { NextPage } from "next";
import Head from "next/head";
import Account from "../components/Account";
import NewAccount from "../components/NewAccount";
import NavBar from "../components/NavBar";
import { useState, useEffect } from "react";
import AccountModal from "../components/AccountModal";
import { collection, getDocs } from "firebase/firestore";
import { auth, db } from "../lib/firebase";
import { useAuthState } from "react-firebase-hooks/auth";

const Accounts: NextPage = () => {
  const [isOpen, setIsOpen] = useState(false);
  const [user] = useAuthState(auth);
  const [accounts, setAccounts] = useState<string[]>([]);

  useEffect(() => {
    if (user) getAccounts();
  }, [user]);

  //   get accounts for current user from firestore
  const getAccounts = async () => {
    const querySnapshot = await getDocs(
      collection(db, "users", user!.uid, "accounts")
    );
    querySnapshot.forEach((doc) => {
      setAccounts((accounts) => [...accounts, doc.id]);
    });
  };

  return (
    <>
      <Head>
        <title>Accounts</title>
        <meta name="Accounts" content="Generated by create next app" />
        <link rel="icon" href="/favicon.ico" />
      </Head>
      <NavBar />
      <AccountModal
        isOpen={isOpen}
        currentUser={"hugh"}
        setIsOpen={setIsOpen}
      />
      <div className="flex gap-10 w-full justify-center items-center login">
        <Account name="user" />
        {accounts.map((account, index) => {
          return <Account key={index} name={account} />;
        })}
        <NewAccount isOpen={isOpen} setIsOpen={setIsOpen} />
      </div>
    </>
  );
};

export default Accounts;
